<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">

<head>
	    <meta charset="utf-8"/>
	    <title>Apache 2.x 보안설정</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="DevOps를 위한 정보 제공"/>
	    <meta name="author" content="appaga@appaga.kr"/>
	    <meta name="keywords" content="java, spring boot, android"/>
	    <meta name="generator" content="JBake"/>
		<!-- Custom styles for this template -->
    	<link href="https://fonts.googleapis.com/css?family=Playfair&#43;Display:700,900&amp;display=swap" rel="stylesheet">
	    <!-- Le styles -->
		<link href="../../bootstrap/bootstrap.min.css" rel="stylesheet"/>
		<link href="../../bootstrap/blog.css" rel="stylesheet"/>
	    <link href="../../prettify/prettify.css" rel="stylesheet"/>

	    <!-- Fav and touch icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png"/>
		<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png"/>
		<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png"/>
		<link rel="manifest" href="../../site.webmanifest"/>
	    <link rel="shortcut icon" href="../../favicon.ico"/>		
	</head>

<body>
	<div id="wrap">
		<div>
		<div class="container">
			<header class="blog-header py-3">
				<div class="row flex-nowrap justify-content-between align-items-center">
					<div class="col-4 pt-1">
						<a class="link-secondary" href="../../feed.xml">Subscribe</a>
					</div>
					<div class="col-4 text-center">
						<a class="blog-header-logo text-dark" href="/">APPAGA</a>
					</div>
					<div class="col-4 d-flex justify-content-end align-items-center">
						<a class="btn btn-sm btn-outline-secondary" href="../../about.html">About</a>
					</div>
				</div>
			</header>

			<ul class="nav justify-content-between">
				<li class="nav-item">
					<a class="nav-link" href='../../archive.html'>Archives</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Tags</a>
					<ul class="dropdown-menu">
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/centos.html'>centos</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/mongodb.html'>mongodb</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/linux.html'>linux</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/apache.html'>apache</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/database.html'>database</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/analytics.html'>analytics</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/eclipse.html'>eclipse</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/javascript.html'>javascript</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/springboot.html'>springboot</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/thymeleaf.html'>thymeleaf</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/google.html'>google</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/ubuntu.html'>ubuntu</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/tomcat.html'>tomcat</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
		<main class="container">
			<div class="page-header">
				<h1>Apache 2.x 보안설정</h1>
			</div>
			<p><em>12 April 2022</em></p>
			<p><p>apache 2.x에서 보안을 위한 설정을 알아본다.<br />
응답 header에 서버 정보가 자세히 표시되는 것을 <code>ServerTokens</code>을 이용하여 최소화 할 수 있다.</p>
<p>사용하지도 않는 메소드를 차단한다. 주로 사용하는 <code>GET</code>, <code>POST</code>만 남겨놓고 나머지는 제거한다.<br />
<code>curl</code> 명령으로 최종 적용된 상태를 확인할 수 있다.</p>
<h2>서버정보 숨기기</h2>
<p><code>ServerTokens</code> 지시자로 응답 header에 표시되는 서버 정보를 최소화 한다.</p>
<p>설정을 안한 상태에서는 아래와 같이 서버의 정보가 꽤나 자세히 제공된다.</p>
<p><img src="/img/was/was001.jpg" alt="img01" /></p>
<p>서버 정보 표시를 최소 정보인 <code>Apache</code>만 표시되도록 설정을 추가 한다.<br />
<code>/etc/httpd/conf/httpd.conf</code>에 추가 한다.<br />
하단에 표시되는 아파치 정보를 제거하기 위해서 <code>ServerSignature</code>를 <code>Off</code>로 설정한다.<br />
디폴트가 <code>Off</code>이기 때문에 설정을 안해줘도 된다.</p>
<pre><code>ServerTokens Prod
ServerSignature Off
</code></pre>
<p>아파치 서버 재기동 한다.</p>
<pre><code class="language-sh">]# service httpd restart
</code></pre>
<p><img src="/img/was/was001_1.jpg" alt="img01" /></p>
<h2>GET, POST 메소드만 허용하기</h2>
<p>특별한 설정을 하지 않은 경우에는 아래와 같이 <code>curl</code> 명령으로 테스트 하면<br />
<code>Allow</code>에 <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>TRACE</code>, <code>OPTIONS</code>, <code>PATCH</code> 모든 메소드가 허락된 것을 확인할 수 있다.</p>
<pre><code class="language-sh">]# curl -v -X OPTIONS https://appaga.kr/
* About to connect() to appaga.kr port 443 (#0)
*   Trying 127.0.0.1...
* Connected to appaga.kr (127.0.0.1) port 443 (#0)
&gt; OPTIONS / HTTP/1.1
&gt; User-Agent: curl/7.29.0
&gt; Host: appaga.kr
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200
&lt; Date: Tue, 12 Apr 2022 13:44:41 GMT
&lt; Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips
&lt; Allow: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH
&lt; Content-Length: 0
&lt; Set-Cookie: JSESSIONID=C27E22F18378DE344B761DCFB8DD971C; Path=/; Secure; HttpOnly; SameSite=None
&lt;
</code></pre>
<p>아파치의 <code>vhost.conf</code>나 <code>ssl.conf</code>에 <code>GET</code>, <code>POST</code> 메소드 외에는 제거하는 아래와 같은 설정을 추가한다.<br />
<code>Directory</code> 지시자를 사용하여도 된다.<br />
나의 경우에는 <code>Location</code> 지시자를 사용 중에 있어 그대로 이용했다.</p>
<pre><code class="language-xml">&lt;Location /&gt;
        &lt;LimitExcept GET POST&gt;
                Order deny,allow
                Deny from all
        &lt;/LimitExcept&gt;
&lt;/Location&gt;
</code></pre>
<p>아파치 서버 재기동 후에 동일한 <code>curl</code> 명령을 실행하면 이제는 <code>Forbidden</code> 결과로 응답된다.</p>
<pre><code>]# curl -v -X OPTIONS https://appaga.kr/
&gt; OPTIONS / HTTP/1.1
&gt; User-Agent: curl/7.29.0
&gt; Host: appaga.kr
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 403 Forbidden
&lt; Date: Tue, 12 Apr 2022 14:07:16 GMT
&lt; Server: Apache
&lt; Content-Length: 202
&lt; Content-Type: text/html; charset=iso-8859-1
</code></pre>
</p>
		</main>
	</div>
	<div>
			<footer class="blog-footer">
		    	<p class="muted credit">&copy; 2022 APPAGA.KR</p>
		    	<p>
					<a href="#">Back to top</a>
				</p>
		    </footer>

		    <!-- javascript. Placed at the end of the document so the pages load faster -->
			<script src="../../js/jquery-3.6.0.min.js"></script>
			<script src="../../bootstrap/bootstrap.bundle.min.js"></script>
			<script src="../../prettify/prettify.js"></script>
		    <script src="../../js/appaga.js"></script>
			
			<!-- Global site tag (gtag.js) - Google Analytics -->
			<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB6XQ6972F"></script>
			<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-VB6XQ6972F');
			</script>
    	</div>
</body>

</html>