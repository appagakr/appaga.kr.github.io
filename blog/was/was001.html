<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">

<head>
	    <meta charset="utf-8"/>
	    <title>Apache 2.x + Tomcat 설정</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="DevOps를 위한 정보 제공"/>
	    <meta name="author" content="appaga@appaga.kr"/>
	    <meta name="keywords" content="java, spring boot, android"/>
	    <meta name="generator" content="JBake"/>
	    <!-- styles -->
		<link href="../../bootstrap/bootstrap.min.css" rel="stylesheet"/>
		<link href="../../font-nanum/font-nanum.css" rel="stylesheet"/>
		<link href="../../bootstrap/blog.css" rel="stylesheet"/>
	    <link href="../../prettify/prettify.css" rel="stylesheet"/>

	    <!-- Fav and touch icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png"/>
		<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png"/>
		<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png"/>
		<link rel="manifest" href="../../site.webmanifest"/>
	    <link rel="shortcut icon" href="../../favicon.ico"/>		
	</head>

<body>
	<div id="wrap">
		<div>
		<div class="container">
			<header class="blog-header py-3">
				<div class="row flex-nowrap justify-content-between align-items-center">
					<div class="col-4 pt-1">
						<a class="link-secondary" href="../../feed.xml">Subscribe</a>
					</div>
					<div class="col-4 text-center">
						<a class="blog-header-logo text-dark" href="/">APPAGA</a>
					</div>
					<div class="col-4 d-flex justify-content-end align-items-center">
						<a class="btn btn-sm btn-outline-secondary" href="../../about.html">About</a>
					</div>
				</div>
			</header>

			<ul class="nav justify-content-between">
				<li class="nav-item">
					<a class="nav-link" href='../../archive.html'>Archives</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Tags</a>
					<ul class="dropdown-menu">
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/centos.html'>centos</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/mongodb.html'>mongodb</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/html.html'>html</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/linux.html'>linux</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/apache.html'>apache</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/database.html'>database</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/analytics.html'>analytics</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/eclipse.html'>eclipse</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/javascript.html'>javascript</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/springboot.html'>springboot</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/thymeleaf.html'>thymeleaf</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/google.html'>google</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/android.html'>android</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/ubuntu.html'>ubuntu</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/tomcat.html'>tomcat</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
		<main class="container">
			<div class="page-header">
				<h1>Apache 2.x + Tomcat 설정</h1>
			</div>
			<p><em>01 April 2022</em></p>
			<p><p>apache 2.x에서 SSL 설정과 tomcat으로 proxy 하는 아파치 설정이다.</p>
<p><code>80</code> 포트로 접속을 시도하면 <code>443</code> 포트로 리다이렉트 하도록 설정하여 언제나 <code>https://</code> 프로토콜로 제공되도록 한다.</p>
<p>tomcat으로 proxy하여 원하는 url을 tomcat에서 제공하도록 설정한다.<br />
만약 tomcat으로 proxy 하지 않도록 하려면 느낌표 <code>!</code>로 proxy에서 예외처리 한다.</p>
<h2>80 포트를 443 포트로 리다이렉트</h2>
<p><code>http://</code>로 접속을 시도하면 <code>https://</code>로 전환되도록 설정한다.</p>
<h3><code>Redirect</code> 속성으로 하는 방법</h3>
<pre><code class="language-xml">&lt;VirtualHost *:80&gt;
ServerName appaga.kr
Redirect permanent / https://appaga.kr/
&lt;/VirtualHost&gt;
</code></pre>
<h3><code>RewriteEngine</code> 으로 하는 방법</h3>
<pre><code class="language-xml">&lt;VirtualHost *:80&gt;
ServerName appaga.kr
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
&lt;/VirtualHost&gt;
</code></pre>
<h2>443 포트 SSL 설정</h2>
<p>발급받은 SSL 인증서 파일들을 <code>/etc/httpd/ssl/2020/</code> 폴더에 저장하여 사용한다.</p>
<p>tomcat은 8080 포트로 실행 중이며 proxy를 이용하여 모든 요청을 tomcat으로 전달 시킨다.</p>
<p>만약 tomcat으로 proxy 하지 않도록 하려면 <code>ProxyPass /resources !</code> 처럼 느낌표 <code>!</code>로 proxy에서 예외처리 한다.</p>
<pre><code class="language-xml">Listen 443 https
SSLPassPhraseDialog exec:/usr/libexec/httpd-ssl-pass-dialog
SSLSessionCache         shmcb:/run/httpd/sslcache(512000)
SSLSessionCacheTimeout  300

SSLRandomSeed startup file:///dev/urandom  256
SSLRandomSeed connect builtin

SSLCryptoDevice builtin

&lt;VirtualHost *:443&gt;
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html
	ServerName appaga.kr

	ErrorLog logs/error.log
	CustomLog logs/access.log combined

	SSLEngine on
	SSLProtocol all -SSLv2 -SSLv3
	SSLCipherSuite ECDHE-RSA-AES128-SHA256:AES128-GCM-SHA256:!RC4:HIGH:!MD5:!aNULL:!EDH

	SSLCertificateFile      /etc/httpd/ssl/2020/appaga.kr.crt
	SSLCertificateKeyFile   /etc/httpd/ssl/2020/appaga.kr.key
	SSLCACertificateFile /etc/httpd/ssl/2020/appaga.kr.crt

	ProxyRequests Off
	ProxyPreserveHost On

	&lt;Proxy *&gt;
		Order deny,allow
		Allow from all
	&lt;/Proxy&gt;

	ProxyPass /resources !
	ProxyPass / http://127.0.0.1:8080/
	ProxyPassReverse / http://127.0.0.1:8080/
	&lt;Location /&gt;
		Order allow,deny
		Allow from all
	&lt;/Location&gt;

&lt;/VirtualHost&gt;
</code></pre>
</p>
		</main>
	</div>
	<div>
			<footer class="blog-footer">
		    	<p class="muted credit">&copy; 2022 APPAGA.KR</p>
		    	<p>
					<a href="#">Back to top</a>
				</p>
		    </footer>

		    <!-- javascript. Placed at the end of the document so the pages load faster -->
			<script src="../../js/jquery-3.6.0.min.js"></script>
			<script src="../../bootstrap/bootstrap.bundle.min.js"></script>
			<script src="../../prettify/prettify.js"></script>
		    <script src="../../js/appaga.js?20220602092738"></script>
			
			<!-- Global site tag (gtag.js) - Google Analytics -->
			<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB6XQ6972F"></script>
			<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-VB6XQ6972F');
			</script>
    	</div>
</body>

</html>