<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">

<head>
	    <meta charset="utf-8"/>
	    <title>Ubuntu 22.04에 postregsql 설치</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="DevOps를 위한 정보 제공"/>
	    <meta name="author" content="appaga@appaga.kr"/>
	    <meta name="keywords" content="java, spring boot, android"/>
	    <meta name="generator" content="JBake"/>
	    <!-- styles -->
		<link href="../../bootstrap/bootstrap.min.css" rel="stylesheet"/>
		<link href="../../font-nanum/font-nanum.css" rel="stylesheet"/>
		<link href="../../bootstrap/blog.css" rel="stylesheet"/>
	    <link href="../../prettify/prettify.css" rel="stylesheet"/>

	    <!-- Fav and touch icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png"/>
		<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png"/>
		<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png"/>
		<link rel="manifest" href="../../site.webmanifest"/>
	    <link rel="shortcut icon" href="../../favicon.ico"/>		
	</head>

<body>
	<div id="wrap">
		<div>
		<div class="container">
			<header class="blog-header py-3">
				<div class="row flex-nowrap justify-content-between align-items-center">
					<div class="col-4 pt-1">
						<a class="link-secondary" href="../../feed.xml">Subscribe</a>
					</div>
					<div class="col-4 text-center">
						<a class="blog-header-logo text-dark" href="/">APPAGA</a>
					</div>
					<div class="col-4 d-flex justify-content-end align-items-center">
						<a class="btn btn-sm btn-outline-secondary" href="../../about.html">About</a>
					</div>
				</div>
			</header>

			<ul class="nav justify-content-between">
				<li class="nav-item">
					<a class="nav-link" href='../../archive.html'>Archives</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Tags</a>
					<ul class="dropdown-menu">
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/centos.html'>centos</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/mongodb.html'>mongodb</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/html.html'>html</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/linux.html'>linux</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/apache.html'>apache</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/database.html'>database</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/analytics.html'>analytics</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/eclipse.html'>eclipse</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/javascript.html'>javascript</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/springboot.html'>springboot</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/thymeleaf.html'>thymeleaf</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/google.html'>google</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/android.html'>android</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/ubuntu.html'>ubuntu</a>
						</li>
						<li>
							<a class="dropdown-item text-uppercase" href='../../tags/tomcat.html'>tomcat</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
		<main class="container">
			<div class="page-header">
				<h1>Ubuntu 22.04에 postregsql 설치</h1>
			</div>
			<p><em>30 April 2022</em></p>
			<p><p>ubuntu 22.04 서버에 postgresql 설치하고자 한다.<br />
postgresql-14 버전이 설치된다.</p>
<p>신규 패키지 설치전에는 먼저 시스템을 최신으로 업데이트하고 신규 패키지를 설치하도록 한다.<br />
postgresql 서버 설치시에 관련 패키키도 모두 설치한다.<br />
총 161MB 가량의 공간을 필요로 한다.</p>
<p>설치 후 서버 설정을 변경하고 원격에서 접속할 수 있도록 수정하도록 한다.</p>
<p>관리자 계정 <code>postgres</code>의 암호를 변경하여 보안을 강화한다.</p>
<h2>시스템 업데이트</h2>
<p>신규 패키지 설치전에는 먼저 시스템을 최신으로 업데이트하고 시작한다.</p>
<pre><code class="language-bsh">$ sudo apt update
$ sudo apt -y upgrade
</code></pre>
<h2>postgresql 설치</h2>
<p>postgresql 서버와 관련 패키지를 모두 설치한다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo apt-get install postgresql postgresql-contrib
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm14 libpq5 libsensors-config libsensors5 libtypes-serialiser-perl postgresql-14 postgresql-client-14 postgresql-client-common
  postgresql-common ssl-cert sysstat
Suggested packages:
  lm-sensors postgresql-doc postgresql-doc-14 isag
The following NEW packages will be installed:
  libcommon-sense-perl libjson-perl libjson-xs-perl libllvm14 libpq5 libsensors-config libsensors5 libtypes-serialiser-perl postgresql postgresql-14 postgresql-client-14
  postgresql-client-common postgresql-common postgresql-contrib ssl-cert sysstat
0 upgraded, 16 newly installed, 0 to remove and 0 not upgraded.
Need to get 42.4 MB of archives.
After this operation, 161 MB of additional disk space will be used.
Do you want to continue? [Y/n] Y
</code></pre>
<p>설치가 완료되면서 표시되는 정보 중에 다음과 같이 <code>postgres</code> 계정이 생성되고, 데이터베이스 인코딩이 <code>UTF8</code>로 설정된 것을 알 수 있다.</p>
<pre><code class="language-bsh">The files belonging to this database system will be owned by user &quot;postgres&quot;.
This user must also own the server process.

The database cluster will be initialized with locale &quot;en_US.UTF-8&quot;.
The default database encoding has accordingly been set to &quot;UTF8&quot;.
The default text search configuration will be set to &quot;english&quot;.
</code></pre>
<h2>postgresql 서버 상태 확인</h2>
<p><code>systemctl</code> 명령으로 실행 상태를 확인한다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo systemctl status postgresql
● postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/lib/systemd/system/postgresql.service; enabled; vendor preset: enabled)
     Active: active (exited) since Sat 2022-04-30 09:04:16 UTC; 6min ago
    Process: 16232 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
   Main PID: 16232 (code=exited, status=0/SUCCESS)
        CPU: 2ms

Apr 30 09:04:16 appagakr systemd[1]: Starting PostgreSQL RDBMS...
Apr 30 09:04:16 appagakr systemd[1]: Finished PostgreSQL RDBMS.
</code></pre>
<p><code>ss -nlt</code> 명령으로 서버의 소켓 상태를 확인한다.<br />
<code>5432</code> 포트로 로컬 호스트(127.0.0.1)에 대해 오픈된 것을 확인할 수 있다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ ss -nlt
State                 Recv-Q                Send-Q                                Local Address:Port                                 Peer Address:Port                Process
LISTEN                0                     4096                                  127.0.0.53%lo:53                                        0.0.0.0:*
LISTEN                0                     128                                         0.0.0.0:22                                        0.0.0.0:*
LISTEN                0                     244                                       127.0.0.1:5432                                      0.0.0.0:*
LISTEN                0                     128                                            [::]:22                                           [::]:*
</code></pre>
<h2>원격에서 서버에 접속하도록 허용하기</h2>
<p>postgresql은 디폴트로 로컬 호스트(127.0.0.1)에만 접속을 허용하게 설정되어 있다.<br />
설정파일 <code>postgresql.conf</code>을 수정하여 모든 호스트에게 허용하도록 한다.</p>
<pre><code class="language-bsh">$ sudo vi /etc/postgresql/14/main/postgresql.conf
</code></pre>
<p>설정 파일에서 <code>listen_addresses</code> 부분을 찾아서 모든 호스트 <code>'*'</code>로 변경하여 추가해준다.</p>
<pre><code>#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# - Connection Settings -

listen_addresses = '*'                  # all network interfaces;
#listen_addresses = 'localhost'         # what IP address(es) to listen on;

</code></pre>
<p>설정 파일 수정 후에 서버를 재시작하고 소켓 상태를 확인하면 <code>0.0.0.0:5432</code>로 모든 네트워크에 오픈된 것을 확인할 수 있다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo systemctl restart postgresql
appaga@appagakr:~$ ss -nlt
State                 Recv-Q                Send-Q                                Local Address:Port                                 Peer Address:Port                Process
LISTEN                0                     4096                                  127.0.0.53%lo:53                                        0.0.0.0:*
LISTEN                0                     128                                         0.0.0.0:22                                        0.0.0.0:*
LISTEN                0                     244                                         0.0.0.0:5432                                      0.0.0.0:*
LISTEN                0                     128                                            [::]:22                                           [::]:*
LISTEN                0                     244                                            [::]:5432                                         [::]:*
</code></pre>
<p><code>pg_hba.conf</code> 설정 파일에 원격 접속를 허락하고 암호를 이용하도록 설정을 추가해줘야 한다.</p>
<pre><code class="language-bsh">$ sudo vi /etc/postgresql/14/main/pg_hba.conf
</code></pre>
<p>파일의 마지막 줄에 다음 한 줄을 추가한다.</p>
<pre><code>host    all          all            0.0.0.0/0  md5
</code></pre>
<p>설정 파일 수정 후에 서버를 재시작한다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo systemctl restart postgresql
</code></pre>
<h2>postgres 암호 변경</h2>
<p>관리자 계정인 <code>postgres</code>의 암호를 변경하여 보안을 강화한다.<br />
<code>psql</code> 명령을 이용하여 암호를 변경하고 서버를 재기동 한다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo su - postgres
postgres@appagakr:~$ psql -c &quot;ALTER USER postgres WITH PASSWORD '신규암호';&quot;
ALTER ROLE
postgres@appagakr:~$ exit
logout
appaga@appagakr:~$ sudo systemctl restart postgresql
</code></pre>
<h2>timezone, locale 변경</h2>
<p>타임존을 <code>Asia/Seoul</code>로 변경한다.<br />
로케일을 <code>ko_KR.UTF-8</code>로 변경한다.</p>
<p>설정파일 <code>postgresql.conf</code>을 수정하여 변경한다.</p>
<pre><code class="language-bsh">$ sudo vi /etc/postgresql/14/main/postgresql.conf
</code></pre>
<p>다음과 같이 한국 기준으로 설정을 바꾼다.</p>
<pre><code>datestyle = 'iso, ymd'
timezone = 'Asia/Seoul'        
log_timezone = 'Asia/Seoul'
</code></pre>
<p>설정 변경을 적용하기 위해 서버를 재기동 한다.</p>
<pre><code class="language-bsh">$ sudo systemctl restart postgresql
</code></pre>
<h2>사용자, 데이터베이스, 스키마 생성</h2>
<p>어플리케이션 개발을 위해 해당 업무만을 위해 사용자, 데이터베이스, 스키마를 생성한다.</p>
<p><code>create user</code>로 사용자를 생성하고, <code>create database</code>로 데이터베이스를 생성하면서 인코딩과 소유자를 지정한다.<br />
<code>create schema</code>로 스키마를 생성하고 사용자에게 권한을 부여한다.</p>
<pre><code class="language-bsh">appaga@appagakr:~$ sudo su - postgres
postgres@appagakr:~$ psql
psql (14.2 (Ubuntu 14.2-1ubuntu1))
Type &quot;help&quot; for help.

postgres=# create user appaga with password '신규암호';
CREATE ROLE
postgres=# create database appaga_web with encoding='UTF8' owner=appaga;
CREATE DATABASE
postgres=# create schema appaga_web authorization appaga;
CREATE SCHEMA
postgres=# exit

postgres@appagakr:~$ psql -h localhost -U appaga -d appaga_web
Password for user appaga:
psql (14.2 (Ubuntu 14.2-1ubuntu1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type &quot;help&quot; for help.

appaga_web=&gt; \conninfo
You are connected to database &quot;appaga_web&quot; as user &quot;appaga&quot; on host &quot;localhost&quot; (address &quot;127.0.0.1&quot;) at port &quot;5432&quot;.
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
appaga_web=&gt; exit
postgres@appagakr:~$
</code></pre>
</p>
		</main>
	</div>
	<div>
			<footer class="blog-footer">
		    	<p class="muted credit">&copy; 2022 APPAGA.KR</p>
		    	<p>
					<a href="#">Back to top</a>
				</p>
		    </footer>

		    <!-- javascript. Placed at the end of the document so the pages load faster -->
			<script src="../../js/jquery-3.6.0.min.js"></script>
			<script src="../../bootstrap/bootstrap.bundle.min.js"></script>
			<script src="../../prettify/prettify.js"></script>
		    <script src="../../js/appaga.js?20220618105619"></script>
			
			<!-- Global site tag (gtag.js) - Google Analytics -->
			<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB6XQ6972F"></script>
			<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-VB6XQ6972F');
			</script>
    	</div>
</body>

</html>