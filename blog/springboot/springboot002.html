<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">
	<head>
	    <meta charset="utf-8"/>
	    <title>Sprint boot + Mybatis + H2 + Thymeleaf + W3.css 기본 프로젝트</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="DevOps를 위한 정보 제공"/>
	    <meta name="author" content="appaga@appaga.kr"/>
	    <meta name="keywords" content="java, spring framework, spring boot, android, flutter"/>
	    <meta name="generator" content="JBake"/>

	    <!-- Le styles -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	    <link href="../../css/asciidoctor.css" rel="stylesheet"/>
	    <link href="../../css/base.css" rel="stylesheet"/>
	    <link href="../../css/prettify.css" rel="stylesheet"/>

	    <!-- Fav and touch icons -->
		<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png"/>
		<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png"/>
		<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png"/>
		<link rel="manifest" href="../../site.webmanifest"/>
	    <link rel="shortcut icon" href="../../favicon.ico"/>

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB6XQ6972F"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'G-VB6XQ6972F');
		</script>
	</head>
	<body onload="prettyPrint()">
	<div id="wrap">
		<div>
		<div class="container">
		  <header class="blog-header py-3">
		    <div class="row flex-nowrap justify-content-between align-items-center">
		      <div class="col-4 pt-1">
						<a class="link-secondary" href="../../feed.xml">Subscribe</a>
		      </div>
		      <div class="col-4 text-center">
		        <a class="blog-header-logo text-dark" href="/">APPAGA</a>
		      </div>
		      <div class="col-4 d-flex justify-content-end align-items-center">
		        <a href="../../about.html">About</a>
		      </div>
		    </div>
		  </header>

		  <div class="nav-scroller py-1 mb-2">
		    <nav class="nav d-flex justify-content-between">
						<!-- <a class="p-2 link-secondary" th:with="rootpath=(${content.rootpath} ?: '')" th:href="${rootpath}+'tags/mongodb.html'">Mongodb</a> -->
						<a class="p-2 link-secondary" href='../../archive.html'>Archive</a>
		    </nav>
		  </div>
		</div>
	</div>
		<main class="container">

			<div class="page-header">
				<h1>Sprint boot + Mybatis + H2 + Thymeleaf + W3.css 기본 프로젝트</h1>
			</div>

			<p><em>30 May 2020</em></p>

			<p><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" title="Spring Web 2.2.6">Spring boot 2.2.6</a>을 이용한 웹 어플리케이션 기본 프로젝트로 만든 것이다.<br />
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-template-engines" title="Thymeleaf">Thymeleaf</a> 템플릿엔진을 이용하고 <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS">W3.CSS</a>를 사용하여 html/css 퍼블리싱을 한다.</p>
<h2>html/css, font 등 디자인 자원</h2>
<p><a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS">W3.CSS</a>를 이용하여 html 화면 디자인을 처리한다.<br />
<a href="https://www.w3schools.com/w3css/tryw3css_examples_material.htm">Material Design 템플릿</a>을 기본 레이아웃으로 설정하였다.</p>
<p>이미지를 만들 때 PNG 파일의 백그라운드를 제거하여 투명하게 만들 때는 <a href="https://www.remove.bg/">removebg</a> 홈페이지를 이용한다.<br />
백그라운드를 제거하고자 하는 이미지 파일을 드래그앤드롭하여 온라인으로 바로 투명한 백그라운드 갖는 PNG 파일을 얻을 수 있어 유용하다.</p>
<p>폰트는 네이버에서 제공하는 <a href="https://hangeul.naver.com/2017/nanum" title="네이버 한글한글아름답게">나눔스퀘어라운드</a>를 사용한다.<br />
TTF 폰트를 다운받아서 <a href="https://www.font-converter.net" title="Online Font Converter / Web Font Generator">Online Font Convenverter</a>에서 <code>EOT</code>, <code>WOFF</code>, <code>WOFF2</code> 등으로 변환하여 사용하였다.</p>
<pre><code class="language-css">@font-face {
  font-family: &quot;NanumSquareRoundR&quot;;
  src: url(&quot;./fonts/NanumSquareRoundR.eot&quot;); /* IE9 Compat Modes */
  src: url(&quot;./fonts/NanumSquareRoundR.eot?#iefix&quot;) format(&quot;embedded-opentype&quot;), /* IE6-IE8 */
    url(&quot;./fonts/NanumSquareRoundR.otf&quot;) format(&quot;opentype&quot;), /* Open Type Font */
    url(&quot;./fonts/NanumSquareRoundR.svg&quot;) format(&quot;svg&quot;), /* Legacy iOS */
    url(&quot;./fonts/NanumSquareRoundR.ttf&quot;) format(&quot;truetype&quot;), /* Safari, Android, iOS */
    url(&quot;./fonts/NanumSquareRoundR.woff&quot;) format(&quot;woff&quot;), /* Modern Browsers */
    url(&quot;./fonts/NanumSquareRoundR.woff2&quot;) format(&quot;woff2&quot;); /* Modern Browsers */
  font-weight: normal;
  font-style: normal;
}
body {font-family: &quot;NanumSquareRoundR&quot;, sans-serif}
</code></pre>
<h2>Thymeleaf 템플릿엔진 사용</h2>
<p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-template-engines" title="Thymeleaf">Thymeleaf</a>를 템플릿엔진으로 사용한다.</p>
<p><a href="https://github.com/ultraq/thymeleaf-layout-dialect" title="Thymeleaf Layout Dialect">Thymeleaf Layout Dialect</a>에서 제공하는 <code>nz.net.ultraq.thymeleaf</code> 라이브러리를 추가하여 레이아웃 설정을 추가하였다.<br />
다음 디펜던시가 추가되야 한다.</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;nz.net.ultraq.thymeleaf&lt;/groupId&gt;
  &lt;artifactId&gt;thymeleaf-layout-dialect&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>MVC 설정에 타임리프 템플릿엔진 설정하는 부분에 <code>templateEngine.addDialect(new LayoutDialect());</code>로 layout-dialect를 추가해줘야 한다.</p>
<pre><code class="language-java">@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

	/**
	 * 타임리프 속성 생성
	 */
	@Bean
	public SpringResourceTemplateResolver templateResolver() {
		SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();
		templateResolver.setPrefix(&quot;classpath:templates/&quot;);
		templateResolver.setSuffix(&quot;.html&quot;);
		templateResolver.setTemplateMode(TemplateMode.HTML);
		templateResolver.setCharacterEncoding(&quot;UTF-8&quot;);
		// TODO: Template cache is true by default. Set to false if you want
		// templates to be automatically updated when modified.
		templateResolver.setCacheable(false);
		return templateResolver;
	}

	/**
	 * 타임리프 dialect 추가
	 */
	@Bean
	public SpringTemplateEngine templateEngine() {
		SpringTemplateEngine templateEngine = new SpringTemplateEngine();
		templateEngine.setEnableSpringELCompiler(true); // Compiled SpringEL should speed up executions
		templateEngine.setTemplateResolver(templateResolver());
		templateEngine.addDialect(new LayoutDialect()); // nz.net.ultraq.thymeleaf 레이아웃 관리 추가
		return templateEngine;
	}

	@Bean
	public ThymeleafViewResolver viewResolver() {
		ThymeleafViewResolver viewResolver = new ThymeleafViewResolver();
		viewResolver.setTemplateEngine(templateEngine());
		viewResolver.setCharacterEncoding(&quot;UTF-8&quot;);
		viewResolver.setOrder(0);
		return viewResolver;
	}

}
</code></pre>
<h2>XSS 공격 방어 필터 적용</h2>
<p>XSS(Cross-site-scripting) 공격에 대처하기 위하여 get/post 파라미터 및 request body에 필터를 적용한다.</p>
<h3>GET/POST 파라미터에 XSS 공격 방어 필터 적용</h3>
<p>많이 사용되는 <a href="https://github.com/naver/lucy-xss-servlet-filter" title="lucy-xss-servlet-filter">네이버 lucy-xss-servlet-filter</a> 라이브러리를 사용한다.<br />
아래 디펜던시가 추가한다.</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;com.navercorp.lucy&lt;/groupId&gt;
	&lt;artifactId&gt;lucy-xss-servlet&lt;/artifactId&gt;
	&lt;version&gt;2.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>MVC 설정에 필터를 등록한다.</p>
<pre><code class="language-java">@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

	/**
	 * XSS 필터 적용
	 */
	@Bean
	public FilterRegistrationBean&lt;XssEscapeServletFilter&gt; getXssEscapeServletFilterRegistrationBean() {
		FilterRegistrationBean&lt;XssEscapeServletFilter&gt; registrationBean = new FilterRegistrationBean&lt;XssEscapeServletFilter&gt;();
		registrationBean.setFilter(new XssEscapeServletFilter());
		registrationBean.setOrder(1);
		registrationBean.addUrlPatterns(&quot;/*&quot;); // filter를 거칠 url patterns
		return registrationBean;
	}

}
</code></pre>
<h3>request body에 XSS 공격 방어 필터 적용</h3>
<p>Ajax나 restful api 시에 사용되는 request body에는 lucy 필터가 적용되지 않는다고 한다.<br />
request body에 XSS 공격 방어 필터도 같이 적용한다.<br />
필터링을 담당하는 클래스 <code>HTMLCharacterEscapes</code>를 생성하고:</p>
<pre><code class="language-java">public class HTMLCharacterEscapes extends CharacterEscapes {
	private final int[] asciiEscapes;

	private final CharSequenceTranslator translator;

	public HTMLCharacterEscapes() {

		Map&lt;CharSequence, CharSequence&gt; customMap = new HashMap&lt;&gt;();
		customMap.put(&quot;(&quot;, &quot;&amp;#40;&quot;);
		Map&lt;CharSequence, CharSequence&gt; CUSTOM_ESCAPE = Collections.unmodifiableMap(customMap);

		// XSS 방지 처리할 특수 문자 지정
		asciiEscapes = CharacterEscapes.standardAsciiEscapesForJSON();
		asciiEscapes['&lt;'] = CharacterEscapes.ESCAPE_CUSTOM;
		asciiEscapes['&gt;'] = CharacterEscapes.ESCAPE_CUSTOM;
		asciiEscapes['&amp;'] = CharacterEscapes.ESCAPE_CUSTOM;
		asciiEscapes['('] = CharacterEscapes.ESCAPE_CUSTOM;

		// XSS 방지 처리 특수 문자 인코딩 값 지정
		translator = new AggregateTranslator(new LookupTranslator(EntityArrays.BASIC_ESCAPE), // &lt;, &gt;, &amp;, &quot; 는 여기에 포함됨
				new LookupTranslator(EntityArrays.ISO8859_1_ESCAPE),
				new LookupTranslator(EntityArrays.HTML40_EXTENDED_ESCAPE), new LookupTranslator(CUSTOM_ESCAPE));

	}

	@Override
	public int[] getEscapeCodesForAscii() {
		return asciiEscapes;
	}

	@Override
	public SerializableString getEscapeSequence(int ch) {
		return new SerializedString(translator.translate(Character.toString((char) ch)));
	}

}
</code></pre>
<p>MVC 설정에 <code>Jackson</code> 컨버터에 등록해준다.</p>
<pre><code class="language-java">@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

	@Override
	public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
		// request body xss 추가
		converters.add(escapingConverter());

	}

	/**
	 * request body xss 적용
	 */
	@Bean
	public HttpMessageConverter&lt;?&gt; escapingConverter() {
		ObjectMapper objectMapper = new ObjectMapper();
		objectMapper.getFactory().setCharacterEscapes(new HTMLCharacterEscapes());

		MappingJackson2HttpMessageConverter escapingConverter = new MappingJackson2HttpMessageConverter();
		escapingConverter.setObjectMapper(objectMapper);

		return escapingConverter;
	}

}
</code></pre>
<h2>프로젝트 실행 화면</h2>
<p>기본적으로 설정된 프로젝트를 실행하면 아래와 같이 <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS">W3.CSS</a> 템플릿이 적용된 반응형 웹페이지를 확인할 수 있다.<br />
<img src="/assets/img/springboot/springboot_001.png" alt="PC용 대화면 웹페이지" title="PC용 큰화면" /></p>
<p>모바일에서는 왼쪽 네비게이션 메뉴가 좌측 상단의 메뉴 버튼으로 숨겨진다.<br />
<img src="/assets/img/springboot/springboot_002.png" alt="모바일 화면 웹페이지" title="모바일 화면" /></p>
<h2>github 프로젝트</h2>
<p>현재 github 프로젝트에는 spring-security 관련 작업 중인 소스도 같이 들어있으나 실행하여 기본 페이지 표시에는 아무 문제가 없는 상태이다.</p>
<p><a href="https://github.com/appaga/springmvc/tree/master/appagapm" title="github 프로젝트">github 프로젝트</a></p>
<h2>Reference Documentation</h2>
<p>For further reference, please consider the following sections:</p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" title="Spring Web 2.2.6">Spring Web 2.2.6</a></li>
<li><a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS">W3.CSS</a></li>
<li><a href="https://hangeul.naver.com/2017/nanum" title="네이버 한글한글아름답게">나눔스퀘어라운드</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-template-engines" title="Thymeleaf">Thymeleaf</a></li>
<li><a href="https://maven.apache.org/guides/index.html">Official Apache Maven documentation</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/maven-plugin/">Spring Boot Maven Plugin Reference Guide</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#using-boot-devtools">Spring Boot DevTools</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/reference/htmlsingle/#configuration-metadata-annotation-processor">Spring Configuration Processor</a></li>
</ul>
<h2>Guides</h2>
<p>The following guides illustrate how to use some features concretely:</p>
<ul>
<li><a href="https://spring.io/guides/gs/handling-form-submission/">Handling Form Submission</a></li>
<li><a href="https://spring.io/guides/gs/rest-service/">Building a RESTful Web Service</a></li>
<li><a href="https://spring.io/guides/gs/serving-web-content/">Serving Web Content with Spring MVC</a></li>
<li><a href="https://spring.io/guides/tutorials/bookmarks/">Building REST services with Spring</a></li>
</ul>
</p>

			<hr />

		</main>
	</div>
	<div>
			<div id="push"></div>

		    <footer class="blog-footer">
		      <div class="container">
		        <p class="muted credit">&copy; 2022 APPAGA.KR</p>
		      </div>
		    </footer>

		    <!-- javascript. Placed at the end of the document so the pages load faster -->
			<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
		    <script src="../../js/prettify.js"></script>

    	</div>
  </body>
</html>
